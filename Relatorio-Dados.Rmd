---
title: ""
output: 
    pdf_document
link-citations: true
nocite: | 
  @ref1, @ref2, @ref3, @ref4
---

\centering
\raggedright
\begin{center}
```{r pressure, echo=FALSE,out.width = '50%',fig.align='center'}
knitr::include_graphics("unb.jpg")
```
 \Large Universidade de Brasília\\
 IE - Departamento de Estatística
\end{center} 
 \vskip 12em
\begin{center}
 \Large \textbf{Trabalho Final - Análise de Dados Categorizados}
 \par
 \vskip 7em
\end{center}
\setlength{\baselineskip}{.5cm}
\small \textbf{}
\par
\vskip 5em

\begin{flushright}
\Large Eduardo Felipe Machado Côrtes\\
\small 170140784\\
\Large Laura Cristina Melo Teixeira\\
\small 190016051\\
\Large Marcelo Pereira De Souza Fleury\\
\small 190017252
\vskip 2em
\Large Professora: Maria Teresa Leão Costa
\end{flushright}

\vskip 6em
\begin{center}
\setlength{\baselineskip}{.5cm}
Brasília\\
\vskip 1em
Outubro de 2022
\end{center}
\newpage
\tableofcontents
\newpage

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	fig.align = 'center'
)
```


# 1. Introdução e Objetivos

O presente estudo busca elucidar quais fatores impactam na probabilidade de um determinado paciente, que desenvolveu câncer de próstata, ter envolvimento nodal, isto é, a denominação dada quando o câncer já se espalhou para os linfonodos próximos. Para entender quais variáveis são importantes para a predição do envolvimento nodal e de que forma elas estão relacionadas, será feito um estudo exploratório, seguido de uma análise inferencial por meio de modelos de regressão logística.

Para alcançar tais objetivos, este estudo dispõe de uma amostra aleatória de 102 pacientes, contendo as seguintes variáveis pré-operatórias: resultado da radiografia (positivo ou negativo), estágio do tumor (menos grave ou mais grave), nível de fosfatase ácida e envolvimento nodal (sim ou não). Será adotado um nível de significância $\alpha=5\%$. As análises serão feitas por meio do software estatístico R (versão 4.1.2), cujo código está presente na seção de apêndice.

\newpage

# 2. Metodologia

\newpage

# 3. Resultados

## 3.1 Análise Exploratória

Com o intuito de apresentar e compreender as variáveis presentes na amostra, segue-se com as análises exploratórias pertinentes.

```{r}
# Carregar os dados
library(xlsx)
library(tidyverse)
dados <- read.xlsx(file="/home/lauratei/UNB/DADOS/Trabalho/Amostra_g06.xlsx",
                   sheetName = "Amostra_g06")

# Seleciona a amostra n=51
set.seed(12345)
rows_index <- sample(1:nrow(dados),51)
amostra <- dados[rows_index,]

#Define o tema dos gráficos
tema <- theme_bw()+
theme(axis.title.y=element_text(colour="black", size=14),
axis.title.x = element_text(colour="black", size=14),
axis.text = element_text(colour = "black", size=14),
panel.border = element_blank(),
axis.line = element_line(colour = "black"),
plot.title = element_text(hjust = 0.5, size=18),
legend.position = "bottom",
legend.text=element_text(size=18))

```


### 3.1.1 Análises Univariadas

#### 3.1.1.1 Variáveis Explicativas


O resultado da radiografia, variável qualitativa nominal, está representada no gráfico abaixo.

```{r, fig.width=8,out.width = '80%'}
# X1 - Resultado da radiografia
# 0 – negativo 1 – positivo

Fr <- table(amostra$X1)
Pr <- as.data.frame(round(prop.table(Fr) , digits=4 ) * 100 )
colnames(Pr)<-c("Var1","Pr" )
comp <- merge(Fr,Pr, by= "Var1" )
comp$Pr<-paste(gsub( "\\." , "," ,comp$Pr ) , "%" , sep="")
comp$Var1 <- c("Negativo","Positivo")

# Grafico barras
ggplot(comp,aes(x=Var1,y=Freq,label=Pr))+
geom_bar(stat="identity",fill="#6E6DB8")+
geom_text(vjust=-0.5,size=4)+
labs(x="Resultado da radiografia",y="Frequência Absoluta")+
tema

```

A maioria dos pacientes amostrados (cerca de 67%) apresentou o resultado da radiografia negativo. Em relação ao estágio do tumor, variável qualitativa ordinal, observa-se o seguinte gráfico de barras. 


```{r, fig.width=8,out.width = '80%'}
# X2 - Estágio do tumor
# 0 – menos grave ou 1 – mais grave
Fr <- table(amostra$X2)
Pr <- as.data.frame(round(prop.table(Fr) , digits=4 ) * 100 )
colnames(Pr)<-c("Var1","Pr" )
comp <- merge(Fr,Pr, by= "Var1" )
comp$Pr<-paste(gsub( "\\." , "," ,comp$Pr ) , "%" , sep="")
comp$Var1 <- c("Menos grave","Mais grave")

# Grafico barras
ggplot(comp,aes(x=Var1,y=Freq,label=Pr))+
geom_bar(stat="identity",fill="#6E6DB8")+
geom_text(vjust=-0.5,size=4)+
labs(x="Estágio do tumor",y="Frequência Absoluta")+
tema

```


Cerca de 55% dos indivíduos possui um estágio de tumor mais grave, enquanto 45% um estágio menos grave. A análise do nível de fosfatase ácida está apresentada a seguir. 

```{r, fig.width=8,out.width = '80%'}
# X3 - Nível de fosfatase ácida

# Boxplot

ggplot(amostra,aes(x=factor(""),y=X3))+
geom_boxplot(fill=c("#6E6DB8"),width=0.5)+
guides(fill=FALSE)+
stat_summary(fun.y="mean",geom="point",shape=23,size=3,
fill="white")+
labs(x="",y="Nível de fosfatase ácida")+
tema
```

```{r}
# Tabela medidas resumo
library(kableExtra)

summaryX3 <- summary(amostra$X3)

tbl1 <- data.frame("Estatística"=c("Mínimo","1º Quartil",
                                   "Mediana","Média","3º Quartil",
                                   "Máximo","Desvio Padrão"),
                   "Valor"=c(summaryX3,sd(amostra$X3)),
                   check.names = F)

rownames(tbl1)<-NULL

tbl1 %>%
  kableExtra::kbl(.,digits=2,align=c('l','c'),booktabs = T,
                  caption = 'Medidas resumo do nível de fosfatase ácida') %>% 
  kableExtra::kable_classic(full_width=FALSE,latex_options = "HOLD_position")

```

O nível de fosfatase ácida é de, em média, 70,47, um valor próximo da mediana (67), mas que foi um pouco deslocado por conta dos 2 pontos discrepantes (*outliers*) presentes na amostra, cujos valores são 136 e 187. Apesar disso, de forma geral, pode-se dizer que os valores de fosfatase ácida estão distribuídos de forma simétrica em torno da média e com um valor de variância que não é alto, o que pode ser visto pelo seu coeficiente de variação de 38%. 

Por fim, a variável resposta do estudo, o envolvimento nodal, é apresentada na seção seguinte.


#### 3.1.1.2 Variável Resposta

```{r, fig.width=8,out.width = '80%'}
# X4 - Envolvimento nodal
# 0 – sim 1 – não

Fr <- table(amostra$X4)
Pr <- as.data.frame(round(prop.table(Fr) , digits=4 ) * 100 )
colnames(Pr)<-c("Var1","Pr" )
comp <- merge(Fr,Pr, by= "Var1" )
comp$Pr<-paste(gsub( "\\." , "," ,comp$Pr ) , "%" , sep="")
comp$Var1 <- c("Sim","Não")

# Grafico barras
ggplot(comp,aes(x=Var1,y=Freq,label=Pr))+
geom_bar(stat="identity",fill="#6E6DB8")+
geom_text(vjust=-0.5,size=4)+
labs(x="Envolvimento nodal",y="Frequência Absoluta")+
tema

```

O envolvimento nodal, variável qualitativa nominal, é uma condição presente na maior parte dos pacientes pesquisados, cerca de 55%. Enquanto os 45% restantes não apresentam esse cenário do quadro de saúde.

### 3.1.2 Análises Bivariadas

A primeira análise bivariada busca compreender a relação entre o resultado da radiografia com a variável resposta (envolvimento nodal).

```{r}
library(gmodels)
# X1 vs X4
bivariadas<-amostra
bivariadas$X1 <- ifelse(bivariadas$X1==0,"Negativo","Positivo")
bivariadas$X4 <- ifelse(bivariadas$X4==0,"Sim","Não")

names(bivariadas)<-c("ID","Resultado da radiografia",
                     "Estágio do tumor","Nível de fosfatase ácida",
                     "Envolvimento nodal")

# tabela contingencia (formato de saída do SAS)
CrossTable(bivariadas$`Envolvimento nodal`,bivariadas$`Resultado da radiografia`,digits=2)
```

Nota-se pela tabela de contingência que a grande maioria dos pacientes com envolvimento nodal tiveram o resultado da radiografia negativo (89%). Por outro lado, dentre os indivíduos sem envolvimento nodal, a maior parte (61%) teve o resultado da radiografia positivo. Esses percentuais indicam uma possível correlação entre as variáveis. Portanto, temos em seguida o resultado do teste qui-quadrado de associação (independência): 

```{r}
# teste correlação 
chisq.test(x=bivariadas$`Resultado da radiografia`,y=bivariadas$`Envolvimento nodal`)
```

Tendo em vista o baixo p-valor, rejeita-se a hipótese nula de independência entre o envolvimento nodal e o resultado da radiografia. Seguindo a análise bivariada, observa-se a relação entre o estágio do tumor e a variável resposta:


```{r}
# X2 vs X4
bivariadas$`Estágio do tumor` <- ifelse(bivariadas$`Estágio do tumor`==0,"Menos grave","Mais grave")

# tabela contingencia
CrossTable(bivariadas$`Envolvimento nodal`,bivariadas$`Estágio do tumor`,digits=2)
```

A tabela de contingência revela que dentre os pacientes com envolvimento nodal, 68% apresentam estágio de tumor menos grave. Já entre os pacientes em envolvimento nodal o cenário é oposto: 83% estão com um estágio de tumor mais grave. Para confirmar uma possível associação entre essas variáveis realizou-se o teste qui-quadrado de independência:


```{r}
# teste correlação 
chisq.test(x=bivariadas$`Estágio do tumor`,y=bivariadas$`Envolvimento nodal`)
```

Novamente, com o p-valor muito abaixo do nível de significância ($\alpha=5\%$), rejeita-se a hipótese nula de independência. Conclui-se que existe associação entre o envolvimento nodal e o estágio do tumor do paciente. A seguir, obtém-se os gráficos e tabelas para análise da relação entre o nível de fosfatase ácida e o envolvimento nodal.

```{r, fig.width=8,out.width = '80%'}
# X3 vs X4

#Boxplot
ggplot(bivariadas,aes(x=`Envolvimento nodal`,y=`Nível de fosfatase ácida`))+
geom_boxplot(fill=c("#6E6DB8"),width=0.5)+
stat_summary(fun.y="mean",geom="point",shape=23,size=3,
fill="white")+
labs(x="Envolvimento nodal",y="Nível de fosfatase ácida")+
tema

```
```{r}
# Tabela X3 vs X4
library(magrittr)
env_nodal <- amostra %>% filter(X4==0)
sem_env_nodal <- amostra %>% filter(X4==1)

tbl2 <- data.frame("Estatística"=c("Mínimo","1º Quartil",
                                   "Mediana","Média","3º Quartil",
                                   "Máximo","Desvio Padrão"),
                   "Com envolvimento nodal"=c(summary(env_nodal$X3),sd(env_nodal$X3)),
                   "Sem envolvimento nodal"=c(summary(sem_env_nodal$X3),sd(sem_env_nodal$X3)),
                   check.names = F)

rownames(tbl2)<-NULL

tbl2 %>%
  kableExtra::kbl(.,digits=2,align=c('l','c','c'),booktabs = T,
                  caption = 'Medidas resumo da fosfatase ácida por envolvimento nodal') %>% 
  kableExtra::kable_classic(full_width=FALSE,latex_options = "HOLD_position")


```


**Escrever Análise**

\newpage

## 3.2 Modelagem

\newpage

# 4. Conclusão

\newpage

# 5. Apêndice